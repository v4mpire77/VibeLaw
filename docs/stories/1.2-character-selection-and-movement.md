# Story 1.2: Character Selection & Movement

## Status
Approved

## Story
**As a** player,
**I want** to choose between Omar and Maham and control the selected character in a test environment,
**so that** I can interact with the fundamental Vibe Law game world and feel the cozy moment-to-moment gameplay.

## Context Source
- Source Document: `docs/prd/README.md` (Epic 1: Foundation & Core Case Loop)
- Enhancement Type: New core gameplay feature
- Existing System Impact: Extends the current prototype scenes (`CharacterSelectScene`, `OfficeScene`) while preserving the MonoGame bootstrap and scene manager behavior.

## Acceptance Criteria
1. **Character Selection Screen**
   - A start screen presents Omar and Maham with visual portraits or sprites in an 8-bit style.
   - The player can move a highlight/selection cursor using keyboard input (Arrow keys and WASD) and confirm the choice with Enter/Space.
   - The currently highlighted character has distinct visual feedback (e.g., outline, color shift).

2. **Scene Transition**
   - Confirming a choice immediately loads a simple playable scene (can be a prototype office room) with the chosen character instantiated.
   - The selected character's name is passed to subsequent scenes without regression to existing welcome messaging.

3. **Player Movement**
   - The player character can move up, down, left, and right using both Arrow keys and WASD.
   - Movement speed is consistent across directions and frame-rate independent.
   - The character cannot move outside the defined test play area (use simple boundary constraints or collision tiles).

4. **Directional Animations**
   - Each movement direction triggers an appropriate 2+ frame walking animation matching the 8-bit aesthetic.
   - When idle, the character shows the last faced direction with an idle pose.
   - Temporary placeholder sprites are acceptable if they meet the pixel-art style and are clearly separated per direction.

5. **Regression & Performance**
   - The game still boots via `dotnet run --project VibeLaw.Game` without errors.
   - Existing scene manager functionality (including the Office welcome text) remains intact unless superseded by the new playable scene.
   - Input handling avoids double-trigger bugs (e.g., rapid Enter presses do not skip the playable scene).

## Tasks / Subtasks
- [ ] **Experience & Flow**
  - [ ] Update `CharacterSelectScene` to display selectable character portraits, keyboard navigation, and a highlight state for the active choice (Arrow keys and WASD).
  - [ ] Add confirmation feedback (audio cue or visual flash) upon locking in a character and debounce Enter/Space so only the rising-edge triggers `ChangeScene`.
  - [ ] Ensure the selected character identifier is passed through `SceneManager.ChangeScene` and logged for debugging.

- [ ] **Prototype Play Space**
  - [ ] Create a new `PrototypePlayScene` (e.g., `VibeLaw.Game/PrototypePlayScene.cs`) that loads immediately after selection via `SceneManager.ChangeScene`.
  - [ ] Instantiate the chosen character inside the scene and keep reference to the supplied identifier.
  - [ ] Create a simple room/arena (tile map or bounded rectangle) that constrains movement, including collision or clamped position logic.
  - [ ] Display on-screen instructions for controls to aid UX testing.

- [ ] **Player Avatar Implementation**
  - [ ] Introduce a `PlayerCharacter` entity class responsible for movement, animations, and directional idle state.
  - [ ] Map both Arrow keys and WASD input to the movement vectors, using `GameTime.ElapsedGameTime` for frame-rate-independent motion.
  - [ ] Load directional sprite sheets / texture regions for Omar and Maham from the content pipeline.
  - [ ] Implement idle + walking state handling with frame timing independent of frame rate and clamp movement within scene bounds.

- [ ] **Assets & Content Pipeline**
  - [ ] Add temporary 8-bit sprite assets (minimum 2 frames per direction, ~32x32 pixels) for Omar and Maham under `VibeLaw.Game/Content/Characters/`.
  - [ ] Update `VibeLaw.Game/Content.mgcb` to include the new textures and confirm builds succeed without requiring `dotnet mgcb-editor` at runtime.
  - [ ] Document asset provenance or TODOs for future art refinement within the repository (e.g., README under `Content/Characters/`).

- [ ] **Validation**
  - [ ] Run `dotnet run --project VibeLaw.Game` and verify: character selection highlight, debounced confirmation, scene transition, movement with Arrow/WASD, animation, and boundary constraints.
  - [ ] Explicitly regression-test Enter/Space debouncing by pressing the key rapidly to confirm no double-trigger behavior.
  - [ ] Capture a short gameplay note or screenshot for QA reference and store it alongside story artifacts (e.g., `docs/stories/assets/1.2/`).
  - [ ] Update the Change Log and Dev Agent Record sections below during development.

## Dev Notes
- Reuse the existing `Scene` and `SceneManager` infrastructure; avoid introducing new game loops.
- Keep input handling centralized within the `PlayerCharacter` and scene classes to avoid duplicated `Keyboard.GetState()` calls per frame.
- Store temporary art under `VibeLaw.Game/Content/Characters/` and ensure the directory is added to the project if missing.
- The playable scene can remain lightweight (solid color background or tile map) but must respect the architectureâ€™s single `SceneManager` entry-point.
- When passing the selected character identifier to `PrototypePlayScene`, retain it for future UI (e.g., HUD) integrations.

### Testing
- Follow MonoGame testing practices from Story 1.1: manual play test using `dotnet run --project VibeLaw.Game`.
- Verify Arrow/WASD movement directions, animation frame switching, and idle poses for both characters.
- Confirm debounced Enter/Space input does not advance scenes twice; log output can assist regression checks.
- Validate asset pipeline by rebuilding content (`dotnet build --project VibeLaw.Game`) and ensuring no missing content exceptions occur.
- Capture QA evidence (note or screenshot) and link it in the QA Results section once testing is complete.

## Change Log
| Date | Version | Description | Author |
|---|---|---|---|
| TBD | 0.1 | Initial draft of Story 1.2 | Bob (Scrum Master) |

## Dev Agent Record
(To be completed by the Development agent during implementation)

## QA Results
(To be completed by the QA agent after implementation)
